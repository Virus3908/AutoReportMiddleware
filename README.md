# üõ† Middleware-—Å–µ—Ä–≤–∏—Å –Ω–∞ Go

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç **middleware-—Å–µ—Ä–≤–∏—Å**, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ Kafka. –°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –≠—Ç–æ –Ω–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–≤—è–∑–∫–∞ —Å backend-—Å–µ—Ä–≤–∏—Å–æ–º –∏ frontend-—Å–µ—Ä–≤–∏—Å–æ–º

---

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ Kafka (`task` —Ç–æ–ø–∏–∫)<br/>
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –¥–∏–∞—Ä–∏–∑–∞—Ü–∏—è, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤<br/>
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Kafka (`callback` —Ç–æ–ø–∏–∫)<br/>
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å S3 –∏ PostgreSQL<br/>
- –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `zap`<br/>
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ YAML + `.env`<br/>

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
go mod tidy

2. –°–æ–∑–¥–∞–π .env

PG_HOST=127.0.0.1
PG_PORT=5432
PG_USER=virus
PG_PASSWORD=postgres
PG_DATABASE=db

S3_ACCESS_KEY=virus
S3_SECRET_KEY=password
S3_BUCKET=bucket
S3_REGION=ru-central1
S3_ENDPOINT=http://10.66.66.7:9000
S3_PUBLIC_BASE_URL=http://10.66.66.7:9000
S3_MINIO=true

KAFKA_BROKERS=10.66.66.7:9092
KAFKA_GROUP_ID=go_consumer
```

3. –£–∫–∞–∂–∏ –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É
```bash
export CONFIG_PATH=./config/config.yaml
```

4. –°–æ–∑–¥–∞–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ Postgres
–°–æ–∑–¥–∞–π –±–∞–∑—É –∏ –≤ `Makefile` —É–∫–∞–∂–∏ –∞–¥—Ä–µ—Å
```
DATABASE_URL=postgres://user:password@host:5432/database_name?sslmode=disable
```
–ò –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞–π
```bash
make migrate-up
```

‚∏ª

üê≥ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
```bash
make docker-build
make docker-run
```
–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
docker build -t middleware-app .
docker run --rm -it --env-file .env middleware-app
```

‚∏ª

üßæ Makefile –∫–æ–º–∞–Ω–¥—ã<br/>
	‚Ä¢	make generate ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC –∏ SQL-–∫–æ–¥–∞<br/>
	‚Ä¢	make tidy ‚Äî go mod tidy<br/>
	‚Ä¢	make clean ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤<br/>
	‚Ä¢	make docker-build ‚Äî —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞<br/>
	‚Ä¢	make docker-run ‚Äî –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ .env<br/>
    ‚Ä¢	make migrate-up ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö<br/>

‚∏ª

# üîó-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–∞–º –ø–æ —Å–µ–±–µ. –¢—Ä–µ–±—É–µ—Ç—Å—è backend-—Å–µ—Ä–≤–∏—Å (Python), –∫–æ—Ç–æ—Ä—ã–π:<br/>
	‚Ä¢	–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á–∏ –≤ Kafka<br/>
	‚Ä¢	–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Kafka<br/>

–¢–∞–∫ –∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–Ω—è—Ç—å Kafka –∏ Minio.
–¢–∞–∫ –∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é —Å–µ—Ç—å –≤ docker
üëâ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º backend-—Å–µ—Ä–≤–∏—Å–∞ (https://github.com/Virus3908/AutoReporterBack).<br/>
üëâ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º frontend-—Å–µ—Ä–≤–∏—Å–∞ (https://github.com/Virus3908/AutoReportFrontend).<br/>

‚∏ª

‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
.
‚îú‚îÄ‚îÄ cmd/                  # –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/             # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ kafka/            # –ö–æ–Ω—Å—å—é–º–µ—Ä/–ü—Ä–æ–¥—é—Å–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ postgres/         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ repositories/     # SQL-—Å–ª–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ logger/           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ª–æ–≥–≥–µ—Ä–∞ (zap)
‚îú‚îÄ‚îÄ pkg/messages/         # gRPC-—Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/config.yaml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ Makefile              # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```

‚∏ª

üìã TODO <br/>
	‚Ä¢	–ü–æ–∫—Ä—ã—Ç—å unit-—Ç–µ—Å—Ç–∞–º–∏<br/>
	‚Ä¢	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è CI/CD-—Å–±–æ—Ä–∫–∞<br/>
	‚Ä¢	–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ backend API<br/>
	‚Ä¢	Healthcheck —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã<br/>

‚∏ª

üßë‚Äçüíª –ê–≤—Ç–æ—Ä—ã

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ Virus3908. –í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ issue tracker –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é.